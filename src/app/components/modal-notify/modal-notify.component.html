<div *ngIf="visible"
     class="absolute top-0 right-0 mt-16 mr-6 w-[400px] bg-white rounded-2xl shadow-2xl border border-gray-200 animate-slide-left z-50 max-h-[600px] overflow-hidden flex flex-col">
  <div class="flex justify-between items-center p-4 border-b border-gray-200 bg-gray-50">
    <h2 class="text-lg font-bold text-gray-800">
      Notificaciones
      <span *ngIf="hasUnreadNotifications()" 
            class="ml-2 text-xs bg-red-500 text-white px-2 py-1 rounded-full">
        {{ getUnreadCount() }}
      </span>
    </h2>
    <button (click)="cerrarModal()" 
            class="text-gray-400 hover:text-gray-600 text-2xl leading-none">
      &times;
    </button>
  </div>

  <div class="overflow-y-auto flex-1">
    <div *ngIf="notifications.length === 0" 
         class="p-8 text-center text-gray-500">
      <i class='bx bx-bell-off text-5xl mb-2'></i>
      <p>No tienes notificaciones</p>
    </div>

    <div *ngFor="let notification of notifications" 
     class="p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer"
     [class.bg-blue-50]="!notification.leido"
     (click)="handleNotificationClick(notification); verTipoNotificacion(notification)">
      
      <div class="flex items-start gap-3">
        <div class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center"
             [ngClass]="{
               'bg-green-100': notification.tipo === 'approved',
               'bg-red-100': notification.tipo === 'rejected',
               'bg-blue-100': notification.tipo === 'new_permit',
               'bg-yellow-100': notification.tipo === 'pending'
             }">
          <i class="text-xl"
             [ngClass]="{
               'bx bx-check text-green-600': notification.tipo === 'approved',
               'bx bx-x text-red-600': notification.tipo === 'rejected',
               'bx bx-file text-blue-600': notification.tipo === 'new_permit',
               'bx bxs-error-circle text-yellow-600': notification.tipo === 'pending'
             }"></i>
        </div>

        <div class="flex-1 min-w-0">
          <div class="mb-1" *ngIf="notification.informacionRemitente">
            <p class="text-sm font-semibold text-gray-900">
              {{ getNombreRemitente(notification) }}
            </p>
            <p class="text-xs text-gray-500" *ngIf="getEmailRemitente(notification)">
              {{ getEmailRemitente(notification) }}
            </p>
          </div>

          <p class="text-sm text-gray-700 mb-1">
            {{ notification.mensaje }}
          </p>

          <div *ngIf="notification.informacionPermiso" 
               class="mt-2 text-xs bg-gray-100 p-2 rounded">
            <p class="text-gray-600">
              <span class="font-semibold">Permiso #{{ notification.informacionPermiso.permitId }}</span>
            </p>
            <p class="text-gray-600">
              üìù {{ notification.informacionPermiso.motivo }}
            </p>
            <p class="text-gray-600">
              Estado: 
              <span class="font-medium"
                    [ngClass]="{
                      'text-green-600': notification.informacionPermiso.estado === 'approved',
                      'text-red-600': notification.informacionPermiso.estado === 'rejected',
                      'text-yellow-600': notification.informacionPermiso.estado === 'pending'
                    }">
                {{ notification.informacionPermiso.estado }}
              </span>
            </p>
          </div>

          <p class="text-xs text-gray-500 mt-1">
            {{ formatDate(notification.fechaCreacion) }}
          </p>
        </div>

        <div *ngIf="!notification.leido" class="flex-shrink-0">
          <div class="w-2 h-2 bg-blue-600 rounded-full"></div>
        </div>
      </div>

      <div *ngIf="notification.tipo === 'approved' && !notification.leido" 
           class="mt-3 flex gap-2">
        <button
          (click)="descargarPDF(notification); $event.stopPropagation()"
          class="flex-1 flex items-center justify-center bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg px-4 py-2 text-sm shadow-md transition-all">
          <i class='bx bx-download mr-2'></i>
          Descargar PDF
        </button>
      </div>

      <div *ngIf="notification.tipo === 'new_permit' && !notification.leido" 
           class="mt-3 flex gap-2">
        <button
          (click)="verPermiso(notification); $event.stopPropagation()"
          class="flex-1 flex items-center justify-center bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg px-4 py-2 text-sm shadow-md transition-all">
          <i class='bx bx-show mr-2'></i>
          Ver Permiso
        </button>
      </div>
    </div>
  </div>

  <div class="p-3 border-t border-gray-200 bg-gray-50 text-center">
    <button 
      (click)="marcarTodasComoLeidas()"
      class="text-sm text-blue-600 hover:text-blue-800 font-medium"
      [disabled]="!hasUnreadNotifications()">
      Marcar todas como le√≠das
    </button>
  </div>
</div>